{{define "explorer"}}
<style>
  .explorer-container {
    display: flex;
    height: 100%;
    border-radius: 12px;
    flex-grow: 0;
    flex-shrink: 0;
  }

  .search-col {
    width: 30%;
    height: 100%;
    border-right: 4px solid black;
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
  }

  .search-bar {
    height: 5%;

    padding: 10px;
    border-bottom: 4px solid black;
  }

  .post-list {
    padding: 10px;
    flex: 1;
    overflow-y: auto;
    font-size: 20px;
  }

  .post-item {
    display: flex;
    gap: 10px;
  }

  .post-item:hover {
    background-color: aliceblue;
    cursor: pointer
  }

  .post-item.selected {
    background-color: aliceblue;
  }

  .preview-col {
    width: 70%;
    height: 100%;
    display: flex;
    flex-direction: column;

    flex-shrink: 0;
  }

  .read-more {
    height: 5%;
    border-bottom: 4px solid black;
    padding: 10px;
    display: flex;
    align-items: center;
  }

  #preview-pane {
    padding: 10px;
    flex: 1;
    overflow: hidden;
  }

  .tag {}

  .read-more-button {
    padding: 5px;
    margin-left: auto;
    width: 20%;
    max-width: 120px;
    min-width: 90px;
    border: 4px solid var(--outline-color);
    box-shadow: 2px 4px var(--outline-color);

    border-radius: 5px;
    border-bottom-right-radius: 10px;

    cursor: pointer;
    text-align: center;
  }

  .read-more-button:hover {
    background-color: #ABDCAB;
    transition: 0.1s;
  }
</style>
<script>
  // Track the currently selected post
  let currentPostFilename = null;

  function selectPost(filename) {
    currentPostFilename = filename;

    // Update visual selection
    document.querySelectorAll('.post-item').forEach(item => {
      item.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');

    // Update the read more button
    const readMoreBtn = document.querySelector('.read-more-button');
    readMoreBtn.removeAttribute('disabled');

    // Remove old htmx attributes and set new ones
    readMoreBtn.removeAttribute('hx-post');
    readMoreBtn.setAttribute('hx-post', '/window/add/post/' + filename);

    // Re-process the element with htmx
    htmx.process(readMoreBtn);

    // Optional: Add some visual feedback
    console.log('Selected post:', filename);
    console.log('Button hx-post:', readMoreBtn.getAttribute('hx-post'));
  }
</script>
<div class="explorer-container">
  <div class="search-col">
    <div class="search-bar"></div>
    <div class="post-list">
      {{range .Posts}}
      <div class="post-item" onclick="selectPost('{{.Filename}}')" hx-get="/preview/{{.Filename}}"
        hx-target="#preview-pane" hx-trigger="click">
        <div>
          <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M9.29289 1.29289C9.48043 1.10536 9.73478 1 10 1H18C19.6569 1 21 2.34315 21 4V20C21 21.6569 19.6569 23 18 23H6C4.34315 23 3 21.6569 3 20V8C3 7.73478 3.10536 7.48043 3.29289 7.29289L9.29289 1.29289ZM18 3H11V8C11 8.55228 10.5523 9 10 9H5V20C5 20.5523 5.44772 21 6 21H18C18.5523 21 19 20.5523 19 20V4C19 3.44772 18.5523 3 18 3ZM6.41421 7H9V4.41421L6.41421 7ZM7 13C7 12.4477 7.44772 12 8 12H16C16.5523 12 17 12.4477 17 13C17 13.5523 16.5523 14 16 14H8C7.44772 14 7 13.5523 7 13ZM7 17C7 16.4477 7.44772 16 8 16H16C16.5523 16 17 16.4477 17 17C17 17.5523 16.5523 18 16 18H8C7.44772 18 7 17.5523 7 17Z"
              fill="#000000" />
          </svg>
        </div>
        {{.Title}}
      </div>

      {{else}}
      <div>No posts found</div>
      {{end}}
    </div>
  </div>

  <div class="preview-col">
    <div class="read-more">
      <div class="read-more-button" hx-target="#main-window-container" hx-swap="beforeend" disabled>
        Read More
      </div>
    </div>
    <div id="preview-pane">
      <div class="preview-placeholder">
        <p>Select a post to preview</p>
      </div>
    </div>
  </div>
</div>
{{end}}
